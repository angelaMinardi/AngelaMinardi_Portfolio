<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Smart-Insole Technical Design - Angela Minardi</title>
    <link rel="stylesheet" href="css/style.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:400,700|Montserrat:600&display=swap" rel="stylesheet">
    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Prism.js CSS for Syntax Highlighting -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism.min.css" rel="stylesheet" />
    <!-- jsPDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <!-- Chart.js Library -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- D3.js Library -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Prism.js JS for Syntax Highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-python.min.js"></script>
    <!-- Meta Tags for SEO -->
    <meta name="description"
        content="Detailed overview of Angela Minardi's Smart-Insole Technical Design project, showcasing key features and technologies used to predict and prevent falls among geriatric populations.">
    <meta name="keywords"
        content="Angela Minardi, Smart Insole, Gait Analysis, Fall Prevention, IoT, Machine Learning, ESP32, AWS IoT Core">
    <!-- Viewport for Responsive Design -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
    <!-- Navigation Bar -->
    <nav>
        <div class="container">
            <a href="index.html" class="logo">Angela Minardi</a>
            <div class="nav-toggle" aria-label="Toggle navigation menu">
                <i class="fas fa-bars"></i>
            </div>
            <ul class="nav-links">
                <li><a href="index.html#hero">Home</a></li>
                <li><a href="index.html#about">About</a></li>
                <li><a href="index.html#education">Education</a></li>
                <li><a href="index.html#skills">Skills</a></li>
                <li><a href="index.html#projects">Projects</a></li>
                <li><a href="index.html#contact">Contact</a></li>
            </ul>
        </div>
    </nav>

    <!-- Project Detail Section -->
    <section id="project-detail">
        <div class="container">
            <h2>Smart-Insole Technical Design</h2>
            <div class="project-detail-content">
                <img src="images/project4.jpg" alt="Smart-Insole Technical Design" class="detail-img" loading="lazy">
                <p>
                    Falls among geriatric populations represent a significant public health challenge, leading to serious
                    injuries, increased mortality rates, and substantial economic burdens on healthcare systems and
                    families. To address this critical issue, I have developed an innovative smart insole to monitor and
                    analyze gait patterns and foot pressure distribution in real-time, thereby predicting and preventing
                    potential falls.
                </p>
                <h3>System Overview</h3>
                <p>
                    This smart insole integrates advanced sensors, including a Force Sensitive Resistor (FSR) matrix and
                    a 9-axis Inertial Measurement Unit (IMU), which work in tandem with a powerful ESP32 microcontroller
                    to collect and process comprehensive biomechanical data.
                </p>
                <h3>Hardware Design</h3>
                <h4>FSR Matrix Selection and Configuration</h4>
                <h5>Sensor Selection</h5>
                <p>
                    For accurate pressure mapping, I selected thin-film FSRs, specifically the Interlink FSR 402 series,
                    due to their thin profile (less than 0.5 mm thickness), flexibility, and sensitivity to a wide range of
                    force (from 0.2 N to 20 N). FSRs provide high spatial resolution for pressure mapping, essential for
                    detecting subtle changes in plantar pressure distribution associated with gait abnormalities.
                </p>
                <h5>Matrix Configuration</h5>
                <p>
                    The FSRs are arranged in a grid pattern to form a pressure-sensing matrix. The matrix consists of 4 rows
                    and 8 columns, yielding a total of 32 sensors strategically placed to cover critical regions of the
                    foot: Heel, Midfoot, Forefoot, and Toes. This configuration ensures comprehensive coverage and signal
                    redundancy.
                </p>
                <h4>Electrical Circuit Design and Multiplexing</h4>
                <p>
                    Each FSR operates as a variable resistor whose resistance decreases with applied force. They are
                    incorporated into voltage divider circuits to convert resistance changes into voltage signals suitable
                    for analog-to-digital conversion. An ESP32 microcontroller manages the sensor data acquisition and
                    multiplexing.
                </p>
                <h3>Integration of the Inertial Measurement Unit (IMU)</h3>
                <h4>Sensor Selection</h4>
                <p>
                    We integrate the MPU9250 IMU, which combines a 3-axis accelerometer, a 3-axis gyroscope, and a 3-axis
                    magnetometer, providing comprehensive 9-axis motion tracking.
                </p>
                <h4>Sensor Placement</h4>
                <p>
                    The IMU is placed centrally within the insole to align with the foot's center of mass, minimizing rotational
                    artifacts and ensuring accurate measurement of translational and rotational movements pertinent to gait
                    analysis.
                </p>
                <h3>ESP32 Microcontroller and Connectivity</h3>
                <h4>Microcontroller Selection</h4>
                <p>
                    The ESP32 microcontroller is chosen for its dual-core Tensilica LX6 processors, integrated Wi-Fi (IEEE
                    802.11 b/g/n), Bluetooth 4.2 (LE) connectivity, and ample GPIO availability.
                </p>
                <h4>Interfacing and Pin Configuration</h4>
                <p>
                    The FSR matrix interfaces with the ESP32's ADC pins through analog multiplexers, while the IMU communicates
                    via the IÂ²C bus, utilizing SDA and SCL pins with appropriate pull-up resistors.
                </p>
                <h3>Power Supply and Battery Life Estimation</h3>
                <h4>Power Requirements</h4>
                <p>
                    The total current consumption during active operation is estimated to be 83 mA, considering the ESP32
                    during active Wi-Fi transmission, the IMU, and negligible draw from FSRs.
                </p>
                <h4>Battery Selection and Life Calculation</h4>
                <p>
                    A 3.7V, 1000 mAh Li-Po battery is selected for its thin form factor and high energy density. With power
                    management strategies like deep sleep modes and duty cycling, the operational battery life is estimated
                    to extend to approximately three days under typical usage patterns.
                </p>
                <h3>Physical Integration and Insole Design</h3>
                <h4>Material Selection and Layering</h4>
                <p>
                    The insole is constructed using flexible, breathable materials such as ethylene-vinyl acetate (EVA)
                    foam for cushioning and thermoplastic polyurethane (TPU) for durability. The design comprises multiple
                    layers to house the sensor matrix, IMU, and ESP32 securely while ensuring user comfort.
                </p>
                <h3>Data Acquisition and Synchronization</h3>
                <h4>Sampling Rates and Synchronization</h4>
                <p>
                    The FSR matrix and IMU sensors are sampled at 100 Hz, balancing the need for detailed biomechanical data
                    with processing power and energy consumption constraints. Timestamping ensures precise temporal
                    alignment for data fusion.
                </p>
                <h4>Data Buffering and Transmission</h4>
                <p>
                    Data is buffered using circular buffers on the ESP32 and transmitted in structured JSON packets via MQTT
                    over TLS to AWS IoT Core for further processing and storage.
                </p>
                <h3>Data Processing and Feature Extraction</h3>
                <h4>Preprocessing and Noise Filtering</h4>
                <p>
                    Analog signals from the FSRs and IMU undergo low-pass filtering and normalization to remove noise and
                    account for sensor drift. Features such as Center of Pressure (CoP), gait cycle segmentation, and temporal
                    parameters are extracted for analysis.
                </p>
                <h4>Time-Series Forecasting with XGBoost</h4>
                <p>
                    An XGBoost model is trained to predict fall risk scores based on extracted features. The model is deployed
                    on AWS SageMaker for scalable and efficient inference.
                </p>
                <h3>Model Deployment on AWS</h3>
                <p>
                    The trained XGBoost model is deployed as an AWS SageMaker endpoint, enabling real-time fall risk
                    predictions. Data transmission is secured using MQTT over TLS, ensuring privacy and compliance with
                    data protection regulations.
                </p>
                <h3>User Interface and Fall Risk Presentation</h3>
                <h4>Smartphone Application Design</h4>
                <p>
                    A responsive smartphone application provides users with real-time dashboards, interactive data
                    visualizations, personalized recommendations, and configurable notifications to monitor their fall risk
                    and take proactive measures.
                </p>
                <h4>Data Interpretation and Feedback</h4>
                <p>
                    The application categorizes fall risk scores into low, moderate, and high levels, offering actionable insights
                    and enabling data sharing with caregivers and clinicians for comprehensive care coordination.
                </p>
                <h3>Power Management and Battery Optimization</h3>
                <h4>Power-Saving Techniques</h4>
                <p>
                    Implementing deep sleep modes and duty cycling reduces power consumption, extending battery life while
                    maintaining essential functionalities.
                </p>
                <h4>Battery Life Estimation with Power Management</h4>
                <p>
                    Through power management strategies, the smart insole achieves an operational battery life of approximately
                    three days under typical usage patterns.
                </p>
                <h3>Prototype Development and Assembly</h3>
                <h4>Flexible PCB Design</h4>
                <p>
                    The flexible PCB is fabricated using polyimide substrates, ensuring durability and resistance to mechanical
                    stresses during walking. Components are strategically placed to maintain flexibility and minimize stress,
                    enhancing the insole's longevity and reliability.
                </p>
                <h4>Enclosure and Encapsulation</h4>
                <p>
                    Finite Element Analysis (FEA) is conducted to simulate mechanical stresses, ensuring the design withstands
                    repetitive loading without failure. The IMU and ESP32 are encased within protective, waterproof casings to
                    safeguard against environmental factors.
                </p>
                <h4>Future Studies</h4>
                <p>
                    Pilot studies involving elderly participants will assess the system's effectiveness in fall risk prediction,
                    user acceptance, and adherence rates, providing comprehensive evaluations for further enhancements.
                </p>
                <h3>Conclusion</h3>
                <p>
                    The Smart-Insole project represents a significant advancement in fall risk assessment technology for older
                    adults. By integrating high-resolution pressure sensing with comprehensive motion analysis and sophisticated
                    machine learning algorithms, the system provides accurate, real-time predictions of fall risk, enhancing
                    the safety and well-being of its users.
                </p>
            </div>
        </section>

        <!-- Data Acquisition and Visualization Section -->
        <section id="data-acquisition">
            <div class="container">
                <h3>Data Acquisition and Visualization</h3>
                <p>
                    The smart insole collects real-time data from the FSR matrix and IMU sensors, processes it using the ESP32
                    microcontroller, and transmits it securely to AWS IoT Core. The collected data is then stored in DynamoDB
                    and processed using AWS Lambda and SageMaker for predictive analytics. The smartphone application provides
                    interactive visualizations, enabling users to monitor their gait patterns and fall risk scores.
                </p>
                <canvas id="dataChart" width="400" height="200"></canvas>
            </div>
        </section>

        <!-- Feature Extraction and Machine Learning Section -->
        <section id="ml-feature-extraction">
            <div class="container">
                <h3>Feature Extraction and Machine Learning</h3>
                <p>
                    Advanced feature extraction techniques are applied to the sensor data to derive meaningful metrics such as
                    Center of Pressure (CoP), gait cycle segmentation, stride length, and postural stability measures. These
                    features are then used to train an XGBoost model to predict fall risk scores accurately.
                </p>
                <pre><code class="language-python">
# Sample Feature Extraction Code
import pandas as pd
import numpy as np

def extract_features(data):
    features = {}
    
    # Calculate mean and std of FSR sensors
    fsr_columns = [f'fsr_{i}' for i in range(32)]
    features['fsr_mean'] = data[fsr_columns].mean().mean()
    features['fsr_std'] = data[fsr_columns].std().mean()
    
    # Calculate Center of Pressure (CoP)
    x_coords = np.linspace(0, 1, 8)  # Example coordinates
    y_coords = np.linspace(0, 1, 4)
    X, Y = np.meshgrid(x_coords, y_coords)
    X = X.flatten()
    Y = Y.flatten()
    pressures = data[fsr_columns].values.flatten()
    total_pressure = pressures.sum()
    features['CoP_x'] = (X * pressures).sum() / total_pressure
    features['CoP_y'] = (Y * pressures).sum() / total_pressure
    
    # IMU features
    imu_columns = ['imu_accel_x', 'imu_accel_y', 'imu_accel_z',
                  'imu_gyro_x', 'imu_gyro_y', 'imu_gyro_z',
                  'imu_mag_x', 'imu_mag_y', 'imu_mag_z']
    imu_data = data[imu_columns]
    features['imu_mean'] = imu_data.mean().mean()
    features['imu_std'] = imu_data.std().mean()
    
    return features
                </code></pre>
            </div>
        </section>

        <!-- Code Snippets Section -->
        <section id="code-snippets">
            <div class="container">
                <h3>Key Code Snippets</h3>
                <pre><code class="language-cpp">
// Sample ESP32 Firmware Code
#include <WiFi.h>
#include <PubSubClient.h>
#include <Adafruit_MPU9250.h>
#include <Wire.h>
#include <ArduinoJson.h>

// Wi-Fi credentials
const char* ssid = "YOUR_SSID";
const char* password = "YOUR_PASSWORD";

// AWS IoT Core MQTT Broker
const char* mqtt_server = "YOUR_AWS_IOT_ENDPOINT";

// MQTT Topics
const char* publish_topic = "smart_insole/data";

// FSR Matrix Configuration
const int muxControlPins[4] = {5, 18, 19, 21}; // S0, S1, S2, S3
const int fsrChannels = 32;
const int fsrMax = 4095; // 12-bit ADC

// Reference resistor value
const float Rref = 10000.0;

// Initialize Wi-Fi and MQTT Client
WiFiClientSecure espClient;
PubSubClient client(espClient);

// Initialize MPU9250
Adafruit_MPU9250 mpu;

// Function to set multiplexer channels
void setMuxChannel(int channel) {
  for (int i = 0; i < 4; i++) {
    digitalWrite(muxControlPins[i], (channel >> i) & 0x01);
  }
}

// Function to read FSR Matrix
float readFSR(int channel) {
  setMuxChannel(channel);
  delay(10); // Allow mux to settle
  int sensorValue = analogRead(34); // ADC Pin
  // Convert sensor value to force (simplified)
  float voltage = (sensorValue / (float)fsrMax) * 3.3;
  float resistance = (Rref * (3.3 - voltage)) / voltage;
  // FSR response can be calibrated; here we return resistance
  return resistance;
}

// Function to connect to Wi-Fi
void setup_wifi() {
  delay(10);
  Serial.println();
  Serial.print("Connecting to ");
  Serial.println(ssid);

  WiFi.begin(ssid, password);
  while (WiFi.status() != WL_CONNECTED) {
    delay(500);
    Serial.print(".");
  }

  Serial.println("");
  Serial.println("WiFi connected");
  Serial.println("IP address: ");
  Serial.println(WiFi.localIP());
}

// Function to reconnect to MQTT
void reconnect() {
  while (!client.connected()) {
    Serial.print("Attempting MQTT connection...");
    // Attempt to connect
    if (client.connect("ESP32Client")) {
      Serial.println("connected");
    } else {
      Serial.print("failed, rc=");
      Serial.print(client.state());
      Serial.println(" try again in 5 seconds");
      delay(5000);
    }
  }
}

void setup() {
  Serial.begin(115200);

  // Initialize MUX control pins
  for (int i = 0; i < 4; i++) {
    pinMode(muxControlPins[i], OUTPUT);
    digitalWrite(muxControlPins[i], LOW);
  }

  // Initialize ADC pin
  analogReadResolution(12); // 12-bit ADC

  // Initialize MPU9250
  if (!mpu.begin()) {
    Serial.println("Failed to find MPU9250 chip");
    while (1) {
      delay(10);
    }
  }
  mpu.setAccelRange(MPU9250_RANGE_8_G);
  mpu.setGyroRange(MPU9250_RANGE_500_DEG);
  mpu.setMagRange(MPU9250_RANGE_4_Ga);
  mpu.setFilterBandwidth(MPU9250_BAND_21_HZ);

  // Connect to Wi-Fi
  setup_wifi();

  // Configure MQTT
  client.setServer(mqtt_server, 8883);

  // Load AWS certificate
  // Replace with your certificate details
  espClient.setCACert(AWS_CERT_CA);
  espClient.setCertificate(AWS_CERT_CRT);
  espClient.setPrivateKey(AWS_CERT_PRIVATE);
}

void loop() {
  if (!client.connected()) {
    reconnect();
  }
  client.loop();

  // Read FSR data
  JsonObject root;
  StaticJsonDocument<1024> doc;
  root = doc.to<JsonObject>();

  for (int i = 0; i < fsrChannels; i++) {
    float resistance = readFSR(i);
    root["fsr"][i] = resistance;
  }

  // Read IMU data
  sensors_event_t a, g, m;
  mpu.getEvent(&a, &g, &m);

  root["imu"]["accel_x"] = a.acceleration.x;
  root["imu"]["accel_y"] = a.acceleration.y;
  root["imu"]["accel_z"] = a.acceleration.z;

  root["imu"]["gyro_x"] = g.gyro.x;
  root["imu"]["gyro_y"] = g.gyro.y;
  root["imu"]["gyro_z"] = g.gyro.z;

  root["imu"]["mag_x"] = m.magnetic.x;
  root["imu"]["mag_y"] = m.magnetic.y;
  root["imu"]["mag_z"] = m.magnetic.z;

  // Serialize JSON
  char jsonBuffer[2048];
  serializeJson(doc, jsonBuffer);

  // Publish to MQTT
  client.publish(publish_topic, jsonBuffer);

  Serial.println(jsonBuffer);

  // Delay between readings
  delay(1000); // 1 second
}
                </code></pre>
            </div>
        </section>

        <!-- Prototype Demonstration Section -->
        <section id="prototype-demo">
            <div class="container">
                <h3>Prototype Demonstration</h3>
                <div class="video-container">
                    <iframe width="560" height="315" src="https://www.youtube.com/embed/YourVideoID"
                        title="Smart-Insole Technical Design Demo" frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
                        allowfullscreen></iframe>
                </div>
            </div>
        </section>

        <!-- Downloadable Reports Section -->
        <section id="download-reports">
            <div class="container">
                <h3>Download Project Reports</h3>
                <div class="download-buttons">
                    <a href="reports/smart-insole-data.csv" class="btn" download aria-label="Download CSV Data">
                        <i class="fas fa-file-csv"></i> Download CSV Data
                    </a>
                    <a href="reports/smart-insole-report.pdf" class="btn" target="_blank" aria-label="Download PDF Report">
                        <i class="fas fa-file-pdf"></i> Download PDF Report
                    </a>
                </div>
            </div>
        </section>

        <!-- Back to Top Button -->
        <a href="#hero" class="back-to-top" aria-label="Back to Top">
            <i class="fas fa-chevron-up"></i>
        </a>

        <!-- Footer -->
        <footer>
            <div class="container">
                <p>&copy; 2024 Angela Minardi. All rights reserved.</p>
                <ul class="footer-links">
                    <li><a href="index.html#about">About</a></li>
                    <li><a href="index.html#projects">Projects</a></li>
                    <li><a href="index.html#contact">Contact</a></li>
                </ul>
            </div>
        </footer>

        <!-- JavaScript -->
        <script src="js/script.js"></script>
    </body>

</html>
